
import subprocess
from pathlib import Path

# Function to run SUMO with a given configuration file
def run_sumo(config_file, zones_file, sumo_binary="sumo-gui"):
    sumo_cmd = [sumo_binary, "-c", config_file]
    sumo_cmd += ["--additional-files", zones_file]
    try:
        subprocess.run(sumo_cmd, check=True, capture_output=True, text=True)
        print("SUMO simulation completed successfully.")
    except subprocess.CalledProcessError as e:
        print(f"Error running SUMO: {e.stderr}")
        exit(1)

def generate_sumo_conf_file(config_file, network_file, route_file: str | None = None):
    print("Creating SUMO configuration file.")
    try:
        net_name = Path(network_file).name
        route_name = Path(route_file).name if route_file else None
        with open(config_file, "w") as f:
            f.write(f"""<configuration>
        <input>
            <net-file value=\"{net_name}\"/>
#IFROUTE#
{f'            <route-files value=\"{route_name}\"/>' if route_name else ''}
        </input>
        <time>
            <begin value=\"0\"/>
            <end value=\"3600\"/>
        </time>
    </configuration>
    """)
        print("SUMO configuration file created successfully.")
        return str(config_file)
    except Exception as e:
        print(f"Error creating SUMO configuration file: {e}")
        exit(1)
